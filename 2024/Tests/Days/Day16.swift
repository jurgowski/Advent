import Testing
import Advent2024

private struct DPos: Hashable {
    let pos: Pos
    let dir: Dir
}

private func printMap(_ map: [[Character]], posSet: Set<Pos>) {
    var all = posSet
    var printMap = ""
    for y in map.indices {
        for x in map.indices {
            if all.contains(Pos(x, y)) {
                all.remove(Pos(x, y))
                printMap.append("O")
                continue
            }
            if map[y][x] == "#" {
                printMap.append("â–ˆ")
                continue
            }
            if map[y][x] == "." {
                printMap.append(" ")
                continue
            }
            printMap.append(map[y][x])
        }
        printMap.append("\n")
    }
    print("\(all.count) remaining")
    print(printMap)
}

private func part1(input: String) -> Int {
    let map = input
        .split(separator: "\n")
        .map { Array($0) }
    
    var cost: [DPos : Int] = [:]
    var queue: [DPos] = []
    
    for y in map.indices {
        for x in map[y].indices {
            if map[y][x] == "S" {
                let dPos = DPos(pos: Pos(x, y), dir: .east)
                cost[dPos] = 0
                queue.append(dPos)
            }
        }
    }
    
    while !queue.isEmpty {
        queue.sort { cost[$0]! < cost[$1]! }
        let dPos = queue.removeFirst()
        let currentCost = cost[dPos]!

        let forwardDPos = DPos(pos:dPos.pos[dPos.dir], dir: dPos.dir)
        if map[forwardDPos.pos] == "E" {
            return currentCost + 1
        }

        if map[forwardDPos.pos] == "." {
            if (cost[forwardDPos] ?? Int.max) > currentCost + 1 {
                cost[forwardDPos] = currentCost + 1
                queue.append(forwardDPos)
            }
        }

        let rightDPos = DPos(pos: dPos.pos, dir: dPos.dir.rotate)
        if (cost[rightDPos] ?? Int.max) > currentCost + 1000 {
            cost[rightDPos] = currentCost + 1000
            queue.append(rightDPos)
        }

        let leftDPos = DPos(pos: dPos.pos, dir: dPos.dir.revRotate)
        if (cost[leftDPos] ?? Int.max) > currentCost + 1000 {
            cost[leftDPos] = currentCost + 1000
            queue.append(leftDPos)
        }
    }
    return 0
}

private func part2(input: String) -> Int {
    let map = input
        .split(separator: "\n")
        .map { Array($0) }

    var cost: [DPos : Int] = [:]
    var queue: [DPos] = []
    var paths: [DPos: Set<Pos>] = [:]

    for y in map.indices {
        for x in map[y].indices {
            if map[y][x] == "S" {
                let dPos = DPos(pos: Pos(x, y), dir: .east)
                cost[dPos] = 0
                queue.append(dPos)
                paths[dPos] = Set([dPos.pos])
            }
        }
    }
    
    while !queue.isEmpty {
        queue.sort { cost[$0]! < cost[$1]! }
        let dPos = queue.removeFirst()
        let currentCost = cost[dPos]!
        
        let forwardCost = currentCost + 1
        let forwardDPos = DPos(pos:dPos.pos[dPos.dir], dir: dPos.dir)
        if map[forwardDPos.pos] == "E" {
            printMap(map, posSet: paths[dPos]!)
            paths[dPos]!.insert(forwardDPos.pos)
            print("Cost was \(forwardCost) over \(paths[dPos]!.count) tiles")
            return paths[dPos]!.count
        }
        
        if map[forwardDPos.pos] == "." {
            if let currentBestCost = cost[forwardDPos] {
                if currentBestCost == forwardCost {
                    paths[forwardDPos]!.formUnion(paths[dPos]!)
                } else if currentBestCost < forwardCost {
                    cost[forwardDPos] = currentBestCost
                } else if currentBestCost > forwardCost {
                    cost[forwardDPos] = forwardCost
                    paths[forwardDPos] = paths[dPos]!.union(Set([forwardDPos.pos]))
                }
            } else {
                queue.append(forwardDPos)
                cost[forwardDPos] = forwardCost
                paths[forwardDPos] = paths[dPos]!.union(Set([forwardDPos.pos]))
            }
        }
        
        let turnCost = currentCost + 1000
        let rightDPos = DPos(pos: dPos.pos, dir: dPos.dir.rotate)
        if let rightCost = cost[rightDPos] {
            assert(rightCost <= turnCost)
            if rightCost == turnCost {
                paths[rightDPos]!.formUnion(paths[dPos]!)
            }
        } else {
            queue.append(rightDPos)
            cost[rightDPos] = turnCost
            paths[rightDPos] = paths[dPos]!
        }
        
        let leftDPos = DPos(pos: dPos.pos, dir: dPos.dir.revRotate)
        if let currentBestCost = cost[leftDPos] {
            assert(currentBestCost <= turnCost)
            if currentBestCost == turnCost {
                paths[leftDPos]!.formUnion(paths[dPos]!)
            }
        } else {
            queue.append(leftDPos)
            cost[leftDPos] = turnCost
            paths[leftDPos] = paths[dPos]!
        }
    }
    return 0
}

@Test func testDay16DebugPart1() async throws {
    #expect(part1(input: debugInput) == 7036)
    #expect(part1(input: debugInput2) == 11048)
}

@Test func testDay16Part1() throws {
    print(part1(input: input))
}

@Test func testDay16Part2() async throws {
    #expect(part2(input: debugInput) == 45)
    #expect(part2(input: debugInput2) == 64)
}

@Test func testDay16DebugPart2() async throws {
    print(part2(input: input))
}


private let debugInput = """
###############
#.......#....E#
#.#.###.#.###.#
#.....#.#...#.#
#.###.#####.#.#
#.#.#.......#.#
#.#.#####.###.#
#...........#.#
###.#.#####.#.#
#...#.....#.#.#
#.#.#.###.#.#.#
#.....#...#.#.#
#.###.#.#.#.#.#
#S..#.....#...#
###############
"""

private let debugInput2 = """
#################
#...#...#...#..E#
#.#.#.#.#.#.#.#.#
#.#.#.#...#...#.#
#.#.#.#.###.#.#.#
#...#.#.#.....#.#
#.#.#.#.#.#####.#
#.#...#.#.#.....#
#.#.#####.#.###.#
#.#.#.......#...#
#.#.###.#####.###
#.#.#...#.....#.#
#.#.#.#####.###.#
#.#.#.........#.#
#.#.#.#########.#
#S#.............#
#################
"""

private let input = """
#############################################################################################################################################
#.......#...#.#.........#...#.........#.......#.................#...........#...............#.............#.......#.......#.#.............#E#
###.#.#.#.#.#.#.###.###.#.###.#.#######.#.###.#.#.###.#########.#.#####.#.#.#.###.#.###.#.#.#####.###.###.#####.#.###.###.#.#.#.#.#.#####.#.#
#.....#...#.#.....#.......................#.#.#.....#.#.....#.#.#.#.....#.#.#.#.#.#...#.#.#.................#...#...#.#.....#...#.#...#.....#
#.#.#.#####.#.#####.#.#.#####.#########.#.#.#.#.#.#.###.###.#.#.#.#.#####.#.#.#.#.###.#.#.#####.###.#.#.###.#.#####.#.#########.#.###.#######
#.#.....#...#.#.....#.#.....#.#...#.......#...#...#.......#.#...#.#.....#...#.#...#...#...#...#.#.....#...#...#...#.#.........#.#...#.......#
#.#.#.###.###.#.#####.#####.#.#.#.#.###.###.###.#.#########.#####.#####.#.###.#.###.#######.#.#.#.#######.#####.###.#######.#.#.#.#.#######.#
#.#...........................#.#...#.....#.#...#.#.......#...........#.#.....#.#...#.......#...#.#.......#...#.............#.#.#.#.......#.#
#.#.#.#####.#.#.#########.#.###.#####.#.#.#.#.#.#.#.#####.#############.#######.#.###############.#.#######.#.#.###.###########.#.#####.###.#
#.......#...#...#.......#.....#...#.#...#...#.#...#...#.....#.........#.#...#...#.#...............#.#...#...#.#.#...#...........#.#.....#...#
#.#.###.#.###.#.#.#####.#####.###.#.###.#######.#.###.#####.#.#######.#.###.#.###.#.###############.#.#.#.#.#.#.#.#.#.#####.###.#.#.#####.#.#
#.#...................#.....#.#...#...#.#.....#.....#...#...#.....#...#...#.#.#.................#...#.#.#...............#.....#...#...#...#.#
#.#.#####.#.#.###.#.#######.#.#.#####.#.#.###.#########.#.#######.#.#####.#.#.#.#.###########.#.#.###.###.###.#.###.###.#.#.#.#.#.###.#.###.#
#.#...#.#.#.......#.....#.#.#.#.#...#.....#.....#.......#.........#.......#.....#.....#.........#.#.#.....#.........#...#.#.#.#.#.#...#.#...#
#.#.#.#.#.###.#####.#.#.#.#.#.#.#.#.#.#########.#.#####.###################.#.#########.#######.#.#.#.#####.#.#.###.#.#####.#.#.#.#.###.#.###
#...#.#.#...#.....#...#...#.#...#.#.#...#...#.#.#...#...#.........#.......#.#...........#.....#.#.#...#.....#.....#.#.#.....#.#...#...#.#...#
#####.#.###.#####.###.#####.#####.#.#####.#.#.#.###.#.###.#######.#.#####.#.#.###.#.#####.###.###.#.#######.#.#.###.#.###.###.###.###.#.#####
#.....#.....#.#...#...#.....#.....#.......#.#.#.#...#...#.#.....#...#.#...#.#.#.#.......#.........#.........#.#.#...#...#...........#.#.....#
#.#####.#####.#.###.###.#.###.#########.###.#.#.#.#####.#.#####.#####.#.#####.#.#########.#######.###########.###.#.###.#.#######.#.#.#####.#
#.....#.#...#.......#...#.#...#...........#.#.....#.....#.....#.......#...#...............#.....#.#.....#...#...#...#.#.#...#.#...#.#...#...#
#####.#.###.#.#######.###.#.#######.#.#####.#.###############.#.#########.#.#####.#####.#.#.###.###.###.#.#.###.###.#.#.###.#.#.#.#.###.#.#.#
#.....#...#.....#.....#...#...#...#.#.......#.#.......#.....#...#.............#...#.......#.#.#.#...#.#...#...#...#...#.....#.#.#.......#.#.#
#.#######.#.#####.###.#######.#.#.#.###.#.###.#.#####.#.###.###.#.#####.#####.#.###.#######.#.#.#.###.#####.#.#.#.#.#########.#.#.#######.###
#.#.....#.#.#...#.#...#.....#.#.#.#...#.....#.#...#.#...#.#.#...#...#.....#...#...#.#.#.....#.#.#.#.........#.#.#...#.........#.#.......#...#
#.#.###.#.###.#.#.###.#.###.#.#.#.#####.###.#####.#.#####.#.#.#####.#####.#####.#.#.#.#.#####.#.#.#.#####.#.#.#.###.#.#####.###.#.#####.###.#
#.#...#.#...#.#.#...#.#.#...#...#.#.......#.....#.#.......#...#...#...#.#.....#.#.#.#.#.#.....#...#...#...#.#.#...#.#.....#.....#.#.....#...#
#.#.###.###.#.#.###.###.#.#######.#.#########.###.#.#####.#####.#####.#.#####.###.#.#.#.#.#.###########.###.#.#.#.#######.#######.#.#####.#.#
#...#...#.....#.....#...#.....#...#.........#.#...#.....#.#...#.....#.#.......#...#.#.#.#.#.............#...#...#.........#.....#.#.#.....#.#
#.###.#############.#.#######.#.#####.###.#.#.#.###.###.#.#.###.#.###.###.#####.###.#.#.#.###.###########.#####################.#.#.#####.#.#
#.#...#.....#...#...#.....#...#.....#...#.#.#.#.#...#...#.#.....#...#...#.......#.#...#.#...#...#.....#...#...........#.........#.#.....#.#.#
#.#.###.###.#.###.#####.###.#.#####.#.###.#.#.#.###.#.###.#.#######.###.#########.###.#.###.###.#.###.#.###.#.#######.###.#.#####.#####.#.#.#
#...........#.......#...#...#...#.#.#.#...#.#.....#.#.#.#.#.#.....#...#...#...........#...#.#...#.#.#...#.#.#...#.........#.......#.#...#.#.#
#.#.#.###.#.#######.#.###.#####.#.#.###.#####.###.#.#.#.#.###.###.#.#####.#######.#######.###.###.#.#####.#.###.#.###########.#####.#.###.#.#
#.#.......#.....#.....#.#.....#...#...#...#...#...#.#.#...#...#...#.....#...#...#.#.......#...#.........#.......#.#.........#...#.....#...#.#
#.###########.#.#####.#.#####.#######.###.#.###.#####.#.###.###.#####.#.###.#.#.###.#######.###########.#####.#####.#######.#.#.#.#.###.###.#
#.#.#.......#...#.....#.....#...#.....#...#.....#.....#.....#.#.......#.#.#...#...#.#.......#.....#...#.....#.#.....#.....#.#.#.#.......#...#
#.#.#.#####.#.#.#.#####.###.###.#.#.###.#.#########.#.#.#.#.#.#####.###.#.#######.#.#.###.###.###.#.#.#####.#.#.#####.###.#.###.###.#####.###
#.#.#...#.......#.#...#.#.....#...#.......#.........#.#...#.#.........#...#.....#...#...#...#...#...#.#...#.#.#.......#...#...#.#.....#.....#
#.#.###.#####.#.#.#.#.#.#.###.#######.#####.#####.###.#.###.#####.###.###.#####.###########.#.#.#####.###.#.#.#########.#####.#.#.#.#.#####.#
#.#...#.......#.#...#.#.#.#.#.#.....#.......#...#.#...#.....#...#.......#.....#...........#...#.....#...#.#.....#.......#...#.#.#.#.#.#...#.#
#.###.#######.#####.#.#.#.#.#.#.###.#.#########.#.#.#####.###.#.#######.#####.#####.#####.#.#.#####.###.#.###.###.#####.#.#.#.#.#.#.#.#.#.###
#.......#...#.........#.#.#.#...#...#...........#.#...........#...#.....#...#.....#...#.#.#.#.....#.#.#.#...#.#...#.......#...#.....#...#...#
#######.###.#.#######.#.#.#.#####.#####.#####.#.#.#####.#.#######.#.#.#.#.#.#####.###.#.#.#.#.#####.#.#.###.#.#.#####.#############.###.###.#
#.....#.#.....#...#.#...#.#...#...#.....#...#...#...#...#.#.....#.#.#...#.#.#...#.#...#.#...#.........#...#...#.....#.#...#...........#.#...#
#.#.#.#.#.###.#.#.#.#.###.#.###.###.#####.#.#.#####.#.#.###.###.#.#.###.#.#.###.#.#.###.#.#######.###.###.#.#######.#.#.#.#.#######.#.###.###
#.#.#.#.#.#.....#.......#.#.....#...#.....#...#.....#.#.#...#...#.#...#.#.#.....#.#...#.............#...#.#.#.#.....#...#.#.#.......#...#...#
###.#.#.#.###.###.#######.#.#####.#.#.#########.#####.#.#.###.###.###.#.#.#####.#.###.#########.#.#.###.#.#.#.#.#####.###.#.###.###.###.###.#
#.............#.....#.....#...#.#.....#.......#.#.#...#.#.#.......#...#...#.....#...#...#...#...#.......#.#...#...#.....#.#...#...#...#.#...#
#.#####.#.###.#####.#.#######.#.#.#####.#####.#.#.#.#.#.#.#.###.###.#######.###.###.###.###.#.###.#######.###.###.###.#.#.#.#.#.#.#.###.#.#.#
#.......#...#.....#.#.#...#...#.#.......#...#...#.....#.#.#...#.#...#.....#.....#...#...#...#...#.#.........#...#...#.#...#.#.#.#.......#.#.#
#.#########.#.###.#.#.#.###.###.#.###.#.###.#####.###.###.###.#.###.#.#.###.#####.#.#.###.#.###.###.###.###.#.#####.#.#####.#.#.###.#####.#.#
#.#.....#...#...#.#...#.#...#.....#.....#...#.......#.....#.#.#.....#.#.....#...#.....#...#...#...#.#.#.....#.#.....#...#...#.#.#.........#.#
#.###.#.#.###.###.#####.#.###.#####.#####.#.#.#########.###.#.###.#####.#####.###.#####.#####.###.#.#.#######.#.#######.#####.#.#####.###.###
#.#...#.#.....#...#.#...#...#.#.....#.....#.#...#.....#.....#.#...#...#.#...#.......#...#.#...#.#...#...#.....#...............#.....#...#...#
#.#.###.#####.#.#.#.#.#.###.#.#.#####.#########.#.###.#####.#.#.###.#.#.#.#.###.###.###.#.#.###.#####.#.#.#####.#.###.#####.#######.###.#.#.#
#...#.#.........#...#.#.....#.#.#.#.............#...#.#.....#.#.#.#.#.#...#.....#.#.....#.#.#...#...#.#...#.#...#...#...#.........#...#...#.#
#####.###########.#.#.#########.#.#.#############.###.#.#####.#.#.#.#.###########.#######.#.###.#.#.#.#####.#.#####.###.#.#######.###.###.#.#
#.....#...............#...#.....#.........#...#...#...#.#.....#.#.#...........#...#.......#...#.#...#.......#.......#...#...#.#.....#.....#.#
###.###.###############.#.#.#####.#######.###.#.###.###.#.#####.#.#.#########.#.#.#.#.#.#####.#.#.#.#######.#########.#####.#.#.#.#.#####.#.#
#...#...#.........#...#.#...#...#.....#.......#...#.#.#.#.#.......#.#.....#...#.#.#.#.#.#.....#...#.......#.....#...#.....#...#.#.......#...#
#.#.#.#########.#.#.#.#.#####.#.#.###.###########.#.#.#.#.#########.###.#.#.###.#.#.#.###.###########.#.#######.#.#.#####.###.#.#.#######.#.#
#.#.#.....#.....#...#.#...#...#.....#...#.......#.#.#...#.........#.....#.#.#...#.#.#.............#...#.#.......#.#.......#.#.#.#.#.......#.#
#.#######.#.#####.###.#.#.#.###########.#.###.###.#.#####.#######.#######.#.#####.#.###########.#.#.###.#.#######.#.#######.#.#.#.#.#####.#.#
#.....................#.#.#.#.#.......#.#...#.....#.#...#.#.....#.........#.....#.....#.......#.....#...#.....#...#.#.....#...#.....#...#...#
###.#######.#########.###.#.#.#.#####.#.###.#######.#.#.#.###.#.#######.#.#####.#.#####.#####.#######.#######.#.#####.###.#.#####.#####.#.###
#...#.......#.......#.....#...#...#.....#...#.....#...#.#...#.#.....#...#...#.#.........#.....#.....#.#.#...#.#.........#.#.............#...#
#.###.#######.#####.#######.#.###.#####.#.###.###.#####.###.#####.#.#.#####.#.###########.###.#.###.#.#.#.#.#.###########.#############.#.#.#
#.#...#.....#.#...#.....#.....#.#.#...#.#.....#...#...#.#.#.....#.#.#.........#...#.....#...#.#.#.#.#...#.#...#.........#.#...........#...#.#
#.#.###.#.###.#.#######.#.#####.#.#.#.#.#.#.###.###.#.#.#.#####.###.#########.#.#.#.###.###.###.#.#.#####.#.###.###.#.#.#.#####.#.#######.#.#
#.#.#...#...#.#.#.....#.#.#.....#...#.#.#.#.#.#.#.#.#...#.....#.....#.#...#.......#.........#...#.#...#.........#...#.#.#.......#.......#.#.#
#.#.#.#####.#.#.#.#.###.#.#####.#####.###.#.#.#.#.#.#####.###.#####.#.#.#.###########.#######.###.###.#.#########.###.#.###.###.#####.#.#.#.#
#...#...#...#.#.#.#.#...#.#...#...#...#...#.#...#.#...#.....#.....#.#.#.#.#.........#.......#.#.....#...#.....#.....#.#...#...#.#...#.#.#...#
#.###.#.#.###.#.#.#.#.#.#.#.#.#.#.#.###.###.#.###.###.#####.#####.#.#.###.#.#######.#.#####.#.#.###.#####.###.###.###.###.#####.#.#.#.#.###.#
#.....#...#...#...#.#.#.#.#.#...#.#...#...#.#...#...#.....#...#.....#...#...#.......#.....#.#.#.#...#...#.#.#.........#.......#...#.#.#...#.#
#.###.#####.###.###.#.#.#.#.#####.###.###.#.###.#.#######.###.#.###.#.#####.###.#.#.#####.#.#.#.###.###.#.#.###########.###.#.#.###.###.###.#
#.#.........#.#.#.#.#.#.#...#...#.#.#.#...#...#.#.......#...#.#...#.#.#.....#...#...#.....#.#.#...#.....#.#...........#...#.#.#...#...#.#...#
#.#.#.#######.#.#.#.#.#######.#.#.#.#.#.###.#.#.#.###.#####.#.#####.#.#.#.#.#.#####.#.###.#.#.#.#.###.###.#.#.###.#.#####.#.#.#######.#.#.###
#.................#.#...#.....#.#...#...#.....#.#.........#.#.......#...#.#...#.....#.#...#...#.#...#.#...#.#.....#.....#...#.........#.#.#.#
#.###.#.###.#####.#.###.#.#####.###.#####.#####.###.###.###.#.#######.###.###.#.#####.#.###.###.###.#.#.###.#########.#################.#.#.#
#.#.#...#.#.....#.#...#...#...#...#.....#.....#.#.....#.#.........#...#.#.#.......#...#.#...#...#...#.#.#.#.#.....#...#...........#.....#...#
#.#.#.###.#####.#.###.#######.#.#.#.###.#####.#.#######.#.#######.###.#.#.#.#####.###.#.#.#######.###.#.#.#.###.###.#.#.#####.###.#.###.###.#
#.#...#...#...#.#.#.....#.....#.#.............#.....#...#.#.....#.....#.#.#.#...#.....#.#.........#...#.#.#...#...#.....#...#...#.#.#.....#.#
#.#.#.#.#.#.#.#.#.#.#####.#.###.#####.#############.#.###.#.#.#.###.#.#.#.#.#.#.#######.#.#########.###.#.###.#.#.#########.###.#.###.#####.#
#...#.#.#...#...#.#.......#...#.#...#.............#...#...#.#...#...#...#.#.#.#...#.....#.#.....#.....#.#.....#.#...........#...#...#.#...#.#
#####.#.#.###.###.###########.#.#.#.#############.###.#.###.#.###.###.###.#.#####.#.#######.###.#####.#.#.#.#####.#.#########.#####.#.#.#.#.#
#.#...#.......#.#.#.......#...#.#.#...#.........#.#.#.#.#...#.......#.#...........#.#.......#.#...#...#.#...........#.........#...#...#.#...#
#.#.#.###.###.#.#.###.###.#.###.###.###.#.#.#####.#.#.#.#.#########.###.###.#######.#.#.#####.###.#####.###########.#.#.#.#####.#.###.#.#####
#.#.............#...#.#...#...#...#.....#.......#...#.#.#.#.......#.....#...#.......#.#.#.....#.#.....#.......#...#...#...#.....#.#.#.#.....#
#.#.#####.#.#.#.###.###.#.###.###.#.#######.###.###.#.#.###.#####.###########.#########.#.#.#.#.#####.#####.#.#.#.#.#.#####.#####.#.#.#####.#
#.#.........#.#.........#...#.#...#...#...#...#.....#.#.......#...#...........#.........#.#.#.......#.....#.#.#.#...#...#...#.#...#.#...#...#
#.#####.#.###.###########.###.#.###.#.#.#.###########.#########.###.###########.###.#####.#.#.###########.#.#.#######.#.#.###.#.###.###.#.###
#.......#.....#.......#...#...#.....#.#.#.......#.........#...#.#...#.............#.#...#.#.#...#.....#...#.........#.#.#.....#.#.......#...#
#.#######.#####.#####.#.###.#.#####.###.#######.#.#####.###.#.#.#.#######.#######.#.#.###.#.#.#.#.###.#.###.#######.###.###.#.#.#.#########.#
#.#.....#.....#.#.....#.#...#.#...#.....#.....#...#.......#.#...#.........#.......#.#.....#...#.#...#.#...#...#...#...#.....#.#.#.#.......#.#
#.#.###.#.###.#.#.#####.#.###.#.#########.###.###########.#.#######.#.#####.#######.###.#######.#.#.#.###.###.#.#.#.#.###.###.#.#.###.###.#.#
#.#...#...#...#.#.#.....#.#...#...#.....#...#.............#.#.....#...#...#.....#.....#.......#.#...#...#.#.....#...#...#.....#.#...#.#...#.#
#.#.#####.#.###.#.#####.#.###.###.#.#.#.#########.#######.#.#.#.#######.#######.#.###.#######.#.#.#####.#.#########.###.#.#####.###.###.#.#.#
#.#.#...#.#.....#.....#.#...#.....#.#.#...........#.......#.#.#.......#.......#.#.............#.......#...#.....#.......#.....#.#.......#.#.#
#.###.#.#.#########.#.#.###.#####.#.#.#############.#######.#.#####.###.###.###.#.#####.#.#.#.#######.#.###.###.#######.#####.#.#.#########.#
#.....#...#.........#.#.#...#...#.#.#...#...#.......#...#...#.#...#.......#.#...#.#...#...#.#...#...#.#.....#.#.....#...#.#...#.#...#...#...#
#####.###.#.#.#####.#.#.#.###.#.#.#.###.#.#.#######.#.#.#.#.#.###.#####.###.#.#####.#.#####.#####.#.#.###.###.#####.#.###.#.###.#.###.#.#.###
#...#.#.....#...#...#.#...#...#...#...#.#...#.....#.#.#.#.#.#.......#.......#...#...#.......#.....#.#...#.#.......#...#.#...#...#.#...#...#.#
#.###.#.#.#####.###.#.#.#.#.#####.###.#.#.#.#.###.#.#.#.#.#.###.#####.#########.#.###########.#####.###.#.#.#.#########.#.###.###.#.#######.#
#.....#.......#.....#.#...#.#.......#.#...#.....#.#.#.#...#.#...#.....#.....#...#.......#...#.....#.#.....#.#.#...........#.#...#.#.#.......#
#.#######.###.#####.#.#.#.###.#####.#.#####.#####.#.#.###.#.#.###.###.#.###.#.###.#####.#.#.#####.#.###.#####.#.#.#######.#.###.###.#.#.#####
#.......#.....#.#...#.#.#.........#...#...#...#...#...#...#.#.#...#...#.#.#...#.......#...#.......#...#.#...#...#.....#...#...#.....#.#.....#
#####.###.#####.#.###.#########.#######.#.###.#.#####.#.###.#.#.#####.#.#.#####.#######.#############.###.#.#########.#.#####.#############.#
#.....#...#.....#.....#.......#.#...#...#...#.#.#.....#.#...#.#.#...#...........#.....#...........#.#.....#...........#.#...#...............#
###.###.#.#####.#######.#####.###.#.#.#####.###.#.#####.#####.#.#.#.#######.#####.###.###########.#.#########.#.#####.#.#.#.###.#####.#####.#
#...#...#.......#.....#.....#.....#.#...#.#...#.#.#...#.......#.#.#.......#.....#.#...#.............#.....#...#.#.....#...#...#.....#...#...#
#.#.#.#.#.#.###.#.#####.###.#.#####.###.#.###.#.#.#.###########.#.#######.#####.#.#.###############.#.###.#.###.#############.#########.#.###
#.#...#.....#.#.#.....#...#.#.#...#...#.#.#...#.#.#...........#...#.....#.....#.#.#.....#.........#.#.#...#.#...#.....#.....#...........#.#.#
#.#####.#.###.#.#.###.###.#.###.#.###.#.#.#.###.#.###.###.#.#######.###.#####.#.#.#####.#.#######.#.###.#.#.###.#.###.#.###.#############.#.#
#.....#.#.......#.....#.......#.#...#...#.#.#...#...#.#...#.#.....#...#.....#...#...#...#.#.......#.#...#.#...#.....#...#...#...#.......#.#.#
#####.#.###.#########.#.#####.#.###.#####.#.#.#####.#.#.###.#.#.#.###.#####.#######.#.###.#.#######.#.#.#.###.###########.#.###.#.###.###.#.#
#.....#...#.#.....#...#.#.....#.#.#.....#.....#...#...#...#...#.#...#...#...#.......#.#...#.#.....#...#.#.....#...........#.....#.#...#...#.#
#.#####.#.#.###.#.#.###.#.#.#.#.#.#####.#.###.###.###.###.#.###.###.###.#.###.#####.#.###.#.###.###.#####.#####.#######.#######.#.#.###.###.#
#...#.#...........#.......#.#.#.....#...#.#...#...#...#.#.#...#.#.#.....#.....#...#...#...#...#.#...#.....#.....#.......#.....#.#.#...#...#.#
###.#.#.#.#.#.###.###########.#####.#.###.#.#.#.#.#.###.#.#.#.#.#.#.###########.#.#.###.#####.#.#.###.#####.###.#.#####.###.#.#.#.###.###.#.#
#.#.#...#.#.#.#...#.........#.#.....#...#.#.#.#.#...#...#...#.#.#.............#.#.#.#...#.#...#.#.#.#.#.#...#.#...#...#...#.#...#...#.....#.#
#.#.###.#.#.#.#.###.#####.#.#.#.#######.###.#.#.###.#.###.#.###.#.###.###.###.###.#.###.#.#.###.#.#.#.#.#.#.#.#######.###.#########.#######.#
#.#.......#...#.#.....#.......#.....#.#.....#.#.......#...#...#.#.......#.#.#.....#.....#...#.#.....#.#...............#.#.#.........#.......#
#.#.###.#####.#.#####.#.###########.#.#####.#.#########.###.#.#.#####.#.#.#.#####.#######.###.#.#####.#.#############.#.#.#.#########.#.###.#
#.......#.....#...#...#.#.....#.......#...#.#...#.....#.#...#...#...#.#.#.#.....#.#...#...#...#.#.....#.#...#...#.....#.#.#.#.....#.#.#.#.#.#
#.#.#.#.#.###.###.#.###.#.###.#.#######.#.#####.#.###.#.#.#######.###.#.#.#####.#.###.#.#####.#.#.#######.#.#.###.#####.#.#.###.#.#.#.#.#.#.#
#.#...#...#...#.#.#...#.#.#...#.#...#...#.......#.#.#...#.#...#.....#.#.#.#...#.........#...#...#.........#.#.#.........#.#.....#.#...#.#...#
#.#.###.#####.#.#.#.#.###.#.###.#.#.#.#.#.#######.#.#####.#.#.#####.#.#.#.#.#.#######.#.#.#.#.#####.#######.#.#.#########.#######.#.###.#.###
#.#.....#...#...#.#.#...#.#.....#.#.#.....#.............#...............#.#.#...#.....#.#.#.#.#...#.#...#...#.....#.....#.....#...#.#.#.#...#
###.###.#.#.#.###.#.###.#.#######.#####.#.#.#######.#####.#.#.###.###.###.#.###.###.###.#.#.###.#.#.###.#.#####.###.###.#.#####.###.#.#.#####
#.....#.#.#.#...#.#...#.......#.....#...#.....#...#.#...#.#.....#.....#...#...#...#...#...#...#.#.#.......#...#.#...#.....#...#.#.....#.....#
#.#.#.#.#.#.#.#.#.###.###.###.#.###.#.#.#######.#.###.#.#.#.#.#.#####.#.#.###.###.#.#########.#.#.#######.#.#.###.###.#.#.#.#.#.#####.#####.#
#.#.#.#.#.#...#.#.#.#.#.....#.#...#...#.#.......#.#...#...................................#.#...#.......#...#...#.......#.#.#.#.....#...#...#
#.#.#.#.#.#.#.#.#.#.#.#.###.#.#########.#.#######.#.#.#######.###.#######.#.###.###.###.#.#.###########.#.#####.#.###.#.###.#.#####.#####.###
#.#.....#.#...#.#.#...#.#.#.#...#...#...#...#.#...#.#.....#...#.......................#.#.......#.......#.#...#.#.#.....#...#.....#.....#...#
#.#.#####.#.#.#.#.#.###.#.#.###.#.#.#.#####.#.#.###.#.#.#.#.#.#####.#.#####.#.###.#.#.#.###.#####.#######.#.#.#.#.#.#.#.#.#####.#######.###.#
#.......#.#...#.#.#...#.#.........#...#...#.#...#...#.#.....................#.#...#...#...#.#.....#.....#...#.#.#.#...#.#.....#...#...#.#...#
#.#.###.#.#.#.#.#.#####.#.#########.###.#.#.#.#####.###.###.#.###.#.###########.###.#####.#.#.#######.#.#######.###.#.#######.###.#.#.#.#.#.#
#.....#...#...#...#...#.#.........#.....#...#.....#...#.#.......................#.#.....#...#.#.......#...#...#...#.#...#...#.#.#.#.#...#.#.#
#####.#####.#.#####.#.#.#########.###.###########.###.#.#####.#.#####.#.###.#.#.#.#####.#.###.#.#########.#.#.###.#.#.#.#.#.#.#.#.#.#####.#.#
#S....................................#...............#...............#.........................#...........#.....#...#...#.....#.........#.#
#############################################################################################################################################
"""
